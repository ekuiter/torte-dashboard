<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<link rel="icon" href="./svgs/favicon.svg" type="image/svg+xml">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Centered Iframe with Top Bar</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: Arial, sans-serif;
			display: flex;
			flex-direction: column;
			height: 100vh;
			background-color: #f4f4f4;
		}

		#top-bar {
			width: 100%;
			background-color: #333;
			color: white;
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 10px 20px;
		}

		#title {
			font-size: 24px;
		}

		.menu-button,
		#button {
			padding: 8px 16px;
			font-size: 16px;
			background-color: #555;
			color: white;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			margin-right: 10px;
		}

		.menu-button:hover,
		#button:hover {
			background-color: #777;
		}

		#side-menu {
			position: fixed;
			top: 0;
			left: -300px;
			width: 300px;
			height: 100%;
			background-color: #222;
			color: white;
			padding: 20px;
			transition: left 0.3s ease;
			overflow-y: auto;
		}

		#side-menu.active {
			left: 0;
		}

		.menu-list {
			list-style: none;
			padding: 0;
			max-height: 80vh;
			overflow-y: auto;
		}

		.menu-list li {
			text-align: center;
			padding: 10px;
			border-bottom: 1px solid #444;
			cursor: pointer;
		}

		.menu-list li:hover {
			background-color: #333;
		}

		#iframe-container {
			flex-grow: 1;
			display: flex;
			justify-content: center;
			align-items: center;
			padding: 20px;
		}

		#query-container {
			display: flex;
			align-items: center;
			margin-bottom: 10px;
		}

		#query-container label {
			margin-right: 10px;
		}

		#query-input {
			flex-grow: 1;
			padding: 5px;
			border: 1px solid #444;
			border-radius: 4px;
			background-color: #333;
			color: white;
		}

		iframe {
			width: 80vw;
			height: 70vh;
			border: none;
			/* max-width: 1200px;
			max-height: 800px;
			min-width: 600px;
			min-height: 400px; */
			transition: width 0.3s ease, height 0.3s ease;
			display: block;
		}
	</style>
</head>

<body>
	<div id="side-menu">
		<button id="close-menu" class="menu-button" style="margin-bottom: 8px;">&#x2715;</button>
		<div id="query-container">
			<label for="query-input">Search:</label>
			<input type="text" id="archQuery" placeholder="Architecture or Project" , value="" style="height: 30px">
		</div>
		<ul class="menu-list" id="menu-items">
		</ul>
	</div>

	<!-- Top Bar -->
	<div id="top-bar">
		<button id="menu-button" class="menu-button">â˜°</button>
		<div id="title">Torte Dashboard</div>
		<div id="selected"></div>
		<select id="dataSelector" style="height:30px; padding: 8px">
		</select>
		<button id="button">Go</button>
	</div>

	<div id="iframe-container">
		<!-- Iframe that will load an external URL, such as a website -->
		<!-- <iframe src="https://www.example.com" title="Dynamic Iframe"></iframe> -->
		<iframe align="center" title="Plot" id="plot"
			style="height:800px;width:1510px;border:none;display:block"></iframe>
	</div>
	<script>
		let keys = [];
		let selectedPlot = "";
		let selectedProj = "";
		let titleProj = document.getElementById("selected");
		let s = document.getElementById("dataSelector");
		s.addEventListener("change", (event) => {
			selectedPlot = event.target.selectedOptions[0].id
			console.log(selectedPlot)
		});

		// Function to load and display JSON data
		function loadJsonData() {
			fetch('public/init.json')  // Fetch the JSON file
				.then(response => response.json())  // Parse it as JSON
				.then(data => {
					keys = Array.from(Object.keys(data["plots"]))
					let i = 0;
					for (var key in data["plots"]) {
						var value = data["plots"][key]
						var o = document.createElement('option');
						o.id = key
						o.value = `option${i}`
						if (i == 0) {
							selectedPlot = key
							s.value = o.value;
						}
						o.title = value["desc"]
						o.innerText = value["title"]
						s.appendChild(o);
						i++;
					}
					let m = document.getElementById("menu-items");
					let projects = Array.from(data["projects"])
					console.log(projects)
					i = 0;
					for (const proj of projects) {
						if (i == 0) {
							titleProj.innerText = `Selected Project: ${proj} (Default)`
							selectedProj = proj
						}
						var o = document.createElement('li');
						o.id = proj
						o.addEventListener("click", function () {
							document.getElementById("side-menu").classList.remove("active");
							titleProj.innerText = `Selected Project: ${proj}`
							selectedProj = proj;
						})
						o.innerText = proj
						m.appendChild(o);
						i++
					}

				})
				.catch(error => {
					console.error('Error loading JSON:', error);
				});
		}

		function getPlot() {
			const path = `./public/figures/${selectedPlot}/${selectedPlot}-${selectedProj.replace("/", "-")}.html`
			document.getElementById("plot").src = path

		}
		document.getElementById("menu-button").addEventListener("click", function () {
			document.getElementById("side-menu").classList.add("active");
		});
		document.getElementById("close-menu").addEventListener("click", function () {
			document.getElementById("side-menu").classList.remove("active");
		});
		// Call loadJsonData on page load
		window.addEventListener('load', loadJsonData);
		document.getElementById('button').addEventListener('click', getPlot);
		document.getElementById("archQuery").addEventListener("input", (event) => {
			let root = document.getElementById("menu-items");
			for (var child in root.childNodes) {
				let element = root.childNodes[child];
				if (event.target.value === "") {
					element.hidden = false;
					continue;
				}
				if (element.tagName != "LI") {
					continue
				}
				let lowerStr1 = event.target.value.toLowerCase();
				let lowerStr2 = element.innerText.toLowerCase();

				if (lowerStr2.includes(lowerStr1)) {
					element.hidden = false;
				} else {
					element.hidden = true;
				}
			}
		});

	</script>
</body>

</html>