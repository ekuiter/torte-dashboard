<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<link rel="icon" href="./svgs/favicon.svg" type="image/svg+xml">
	<link rel="stylesheet" href="styles.css">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Centered Iframe with Top Bar</title>
</head>

<body>
	<div id="side-menu">
		<button id="close-menu" class="menu-button" style="margin-bottom: 8px;">&#x2715;</button>
		<div id="query-container">
			<label for="query-input">Search:</label>
			<input type="text" id="archQuery" placeholder="Architecture or Project" , value="" style="height: 30px">
		</div>
		<ul class="menu-list" id="menu-items">
		</ul>
	</div>

	<!-- Top Bar -->
	<div id="top-bar">
		<div>

			<button id="menu-button" class="menu-button">â˜°</button>
		</div>
		<div style="text-align: center;">

			<div id="title">Torte Dashboard</div>
		</div>
		<div>

			<select id="dataSelector" style="height:30px; padding: 8px; float:right">
			</select>
		</div>
	</div>

	<div class="grid-container">
		<div class="card" style="grid-column-start: 1; grid-column-end: 2;">
			<h2>Current Value<h2>
		</div>
		<div class="card" style="grid-column-start: 2; grid-column-end: 6; grid-row-start: 1; grid-row-end: 4;">
			<h2 id="iframeHeader"></h2>
			<div id="iframe-container">
				<iframe align="center" title="Plot" id="plot"
					style="height:800px;width:1510px;border:none;display:block"></iframe>
			</div>
		</div>
		<div class="card" style="grid-column-start: 6; grid-column-end: 7; grid-row-start: 1; grid-row-end: 4;">
			<h2>Description:<h2>
					<p id="plotDesc"></p>
		</div>
		<div class="card" style="grid-column-start: 1; grid-column-end: 2; grid-row-start: 2; grid-row-end: 3;">
			<h2>Compared to last Week:<h2>
		</div>
		<div class="card" style="grid-column-start: 1; grid-column-end: 2; grid-row-start: 3; grid-row-end: 4;">
			<h2>Compared to last month:</h2>
		</div>
	</div>
	<script>
		let keys = [];
		let selectedPlot = "";
		let selectedProj = "";
		let titleProj = document.getElementById("iframeHeader");
		let s = document.getElementById("dataSelector");
		let plotDesc = document.getElementById("plotDesc")
		let allData = {}
		s.addEventListener("change", (event) => {
			selectedPlot = event.target.selectedOptions[0].id
			titleProj.innerText = `Selected: ${allData["linux"]["plots"][selectedPlot]["title"]} for ${selectedProj}`
			getPlot()
		});

		// Function to load and display JSON data
		function loadJsonData() {
			fetch('public/init.json')  // Fetch the JSON file
				.then(response => response.json())  // Parse it as JSON
				.then(data => {
					allData = data;
					keys = Array.from(Object.keys(data["linux"]["plots"]))
					let i = 0;
					for (var key in data["linux"]["plots"]) {
						var value = data["linux"]["plots"][key]
						var o = document.createElement('option');
						o.id = key
						o.value = `option${i}`
						if (i == 0) {
							selectedPlot = key
							s.value = o.value;
						}
						o.title = value["desc"]
						o.innerText = value["title"]
						s.appendChild(o);
						i++;
					}
					let m = document.getElementById("menu-items");
					let projects = Array.from(data["linux"]["projects"])
					console.log(projects)
					i = 0;
					for (const proj of projects) {
						if (i == 0) {
							titleProj.innerText = `Selected: ${selectedPlot} for ${proj} (Default)`
							selectedProj = proj
						}
						var o = document.createElement('li');
						o.id = proj
						o.addEventListener("click", function () {
							document.getElementById("side-menu").classList.remove("active");
							titleProj.innerText = `Selected ${selectedPlot} for ${proj}`
							selectedProj = proj;
							getPlot()
						})
						o.innerText = proj
						m.appendChild(o);
						i++
					}

				})
				.catch(error => {
					console.error('Error loading JSON:', error);
				});
		}

		function getPlot() {
			const path = `./public/figures/${selectedPlot}/${selectedPlot}-${selectedProj.replace("/", "-")}.html`
			titleProj.innerText = `Selected ${allData["linux"]["plots"][selectedPlot]["title"]} for ${selectedProj}`
			document.getElementById("plot").src = path
			plotDesc.innerText = allData["linux"]["plots"][selectedPlot]["desc"]
		}
		document.getElementById("menu-button").addEventListener("click", function () {
			document.getElementById("side-menu").classList.add("active");
		});
		document.getElementById("close-menu").addEventListener("click", function () {
			document.getElementById("side-menu").classList.remove("active");
		});
		// Call loadJsonData on page load
		window.addEventListener('load', loadJsonData);
		document.getElementById("archQuery").addEventListener("input", (event) => {
			let root = document.getElementById("menu-items");
			for (var child in root.childNodes) {
				let element = root.childNodes[child];
				if (event.target.value === "") {
					element.hidden = false;
					continue;
				}
				if (element.tagName != "LI") {
					continue
				}
				let lowerStr1 = event.target.value.toLowerCase();
				let lowerStr2 = element.innerText.toLowerCase();

				if (lowerStr2.includes(lowerStr1)) {
					element.hidden = false;
				} else {
					element.hidden = true;
				}
			}
		});

	</script>
</body>

</html>